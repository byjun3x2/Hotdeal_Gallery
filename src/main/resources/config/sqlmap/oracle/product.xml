<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.hotdeal.product.dao.ProductDAO">

    <!-- [ADD] 컬럼과 VO 필드를 명시적으로 매핑하는 resultMap 정의 -->
    <resultMap id="productResultMap" type="kr.co.hotdeal.product.vo.ProductVO">
        <id property="productId" column="PRODUCT_ID"/>
        <result property="category" column="CATEGORY"/>
        <result property="shopName" column="SHOP_NAME"/>
        <result property="productName" column="PRODUCT_NAME"/>
        <result property="relatedUrl" column="RELATED_URL"/>
        <result property="price" column="PRICE"/>
        <result property="deliveryFee" column="DELIVERY_FEE"/>
        <result property="productImage" column="PRODUCT_IMAGE"/>
    </resultMap>

    <insert id="insertProduct" parameterType="kr.co.hotdeal.product.vo.ProductVO">
    INSERT INTO PRODUCT (
        PRODUCT_ID, CATEGORY, SHOP_NAME, PRODUCT_NAME, RELATED_URL, PRICE, DELIVERY_FEE, PRODUCT_IMAGE
    ) VALUES (
        #{productId}, #{category}, #{shopName}, #{productName}, #{relatedUrl}, #{price}, #{deliveryFee}, #{productImage}
    )
    </insert>
    
    <!-- [FIX] resultMap을 사용하도록 수정 -->
    <select id="getAllProducts" resultMap="productResultMap">
        SELECT PRODUCT_ID, CATEGORY, SHOP_NAME, PRODUCT_NAME, RELATED_URL, PRICE, DELIVERY_FEE, PRODUCT_IMAGE
        FROM PRODUCT
    </select>

    <!-- [FIX] resultMap을 사용하도록 수정 -->
    <select id="getProductById" parameterType="string" resultMap="productResultMap">
        SELECT PRODUCT_ID, CATEGORY, SHOP_NAME, PRODUCT_NAME, RELATED_URL, PRICE, DELIVERY_FEE, PRODUCT_IMAGE
        FROM PRODUCT
        WHERE PRODUCT_ID = #{productId}
    </select>

    <!-- 상품 삭제 쿼리 추가 -->
    <delete id="deleteProduct" parameterType="string">
        DELETE FROM PRODUCT
        WHERE PRODUCT_ID = #{productId}
    </delete>

	<delete id="deleteAllProducts">
    DELETE FROM PRODUCT
	</delete>
	
	<!-- [ADD] 전체 카테고리 목록 조회 쿼리 -->
<!-- PRODUCT 테이블에서 중복을 제외한 모든 카테고리 이름을 가져옵니다. -->
<select id="getAllCategories" resultType="string">
    SELECT DISTINCT CATEGORY FROM PRODUCT WHERE CATEGORY IS NOT NULL ORDER BY CATEGORY
</select>
	
</mapper>
